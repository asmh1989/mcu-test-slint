import { Button, VerticalBox, HorizontalBox } from "std-widgets.slint";
import { ConnectionPanel } from "connection-panel.slint";
import { AddressPanel } from "address-panel.slint";
import { IOControlPanel } from "io-control-panel.slint";
import { FileOperationPanel } from "file-operation-panel.slint";

export global AppState {
    // 连接状态相关
    in-out property <string> mcu-label: "连接";
    in-out property <string> port-value: "COM5";
    in-out property <string> connect-status: "已连接";
    in-out property <bool> is-connected: true;

    // 地址输入相关
    in-out property <string> start-address-label: "地址输入框";
    in-out property <string> param-label: "参数输入/显示框";
    in-out property <string> read-address-button: "读取地址";
    in-out property <string> write-address-button: "写入地址";
    in-out property <string> start-address-value: "";
    in-out property <string> param-value: "";

    // IO控制相关
    in-out property <string> io1-low: "置低";
    in-out property <string> io1-high: "置高";
    in-out property <string> io1-display: "IO1显示";
    in-out property <bool> io1-status: false;
    in-out property <string> io2-low: "置低";
    in-out property <string> io2-high: "置高";
    in-out property <string> io2-display: "IO2显示";
    in-out property <bool> io2-status: false;

    // 文件操作相关
    in-out property <string> file-status: "请选择文件...";
    in-out property <brush> file-status-color: #6c757d;
    in-out property <string> read-file-button: "读取文件";
    in-out property <string> read-device-button: "读取器件";
    in-out property <string> config-file-button: "配置器件";
    in-out property <string> file-content-label: "寄存器地址与参数表";
    in-out property <string> file-content: "";
}

export component AppWindow inherits Window {
    title: "MCU测试工具";
    min-width: 800px;
    min-height: 600px;
    preferred-width: 800px;
    preferred-height: 600px;
    background: #f0f2f5;

    // 回调函数定义
    callback connect-clicked();
    callback port-changed(string);
    callback read-address-clicked();
    callback write-address-clicked();
    callback io1-low-clicked();
    callback io1-high-clicked();
    callback io2-low-clicked();
    callback io2-high-clicked();
    callback read-file-clicked();
    callback read-device-clicked();
    callback config-file-clicked();

    HorizontalBox {
        padding: 20px;
        spacing: 20px;

        // 左侧面板 - 占比25%
        VerticalBox {
            horizontal-stretch: 0.25;
            spacing: 16px;

            // 上：连接面板 - 固定高度
            ConnectionPanel {
                vertical-stretch: 0;
                height: 90px;
                mcu-label-text: AppState.mcu-label;
                port-value <=> AppState.port-value;
                connect-status-text: AppState.connect-status;
                is-connected: AppState.is-connected;
                connect-clicked => {
                    root.connect-clicked();
                }
                port-changed(text) => {
                    root.port-changed(text);
                }
            }

            // 中：地址操作面板 - 弹性高度1
            AddressPanel {
                vertical-stretch: 1;
                min-height: 140px;
                start-address-label: AppState.start-address-label;
                param-label: AppState.param-label;
                read-address-button: AppState.read-address-button;
                write-address-button: AppState.write-address-button;
                start-address-value <=> AppState.start-address-value;
                param-value <=> AppState.param-value;
                read-address-clicked => {
                    root.read-address-clicked();
                }
                write-address-clicked => {
                    root.write-address-clicked();
                }
            }

            // 下：IO控制面板 - 弹性高度1
            IOControlPanel {
                vertical-stretch: 1;
                min-height: 140px;
                io1-low-text: AppState.io1-low;
                io1-high-text: AppState.io1-high;
                io1-display-text: AppState.io1-display;
                io1-status: AppState.io1-status;
                io2-low-text: AppState.io2-low;
                io2-high-text: AppState.io2-high;
                io2-display-text: AppState.io2-display;
                io2-status: AppState.io2-status;
                io1-low-clicked => {
                    root.io1-low-clicked();
                }
                io1-high-clicked => {
                    root.io1-high-clicked();
                }
                io2-low-clicked => {
                    root.io2-low-clicked();
                }
                io2-high-clicked => {
                    root.io2-high-clicked();
                }
            }
        }

        // 右侧面板 - 占比60%
        FileOperationPanel {
            horizontal-stretch: 0.75;
            file-status-text <=> AppState.file-status;
            file-status-color <=> AppState.file-status-color;
            read-file-button-text: AppState.read-file-button;
            read-device-button-text: AppState.read-device-button;
            config-file-button-text: AppState.config-file-button;
            file-content-label: AppState.file-content-label;
            file-content <=> AppState.file-content;
            read-file-clicked => {
                root.read-file-clicked();
            }
            read-device-clicked => {
                root.read-device-clicked();
            }
            config-file-clicked => {
                root.config-file-clicked();
            }
        }
    }
}
