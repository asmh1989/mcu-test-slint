import { Button, VerticalBox, HorizontalBox } from "std-widgets.slint";
import { ConnectionPanel } from "connection-panel.slint";
import { AddressPanel } from "address-panel.slint";
import { IOControlPanel } from "io-control-panel.slint";
import { FileOperationPanel } from "file-operation-panel.slint";
import { AppState } from "globals/app-state.slint";

export { AppState }

export component AppWindow inherits Window {
    title: "MCU测试工具";
    min-width: 800px;
    min-height: 600px;
    preferred-width: 1000px;
    preferred-height: 600px;
    background: #f0f2f5;


    HorizontalBox {
        padding: 20px;
        spacing: 20px;

        // 左侧面板 - 占比25%
        VerticalBox {
            horizontal-stretch: 0.25;
            spacing: 16px;

            // 上：连接面板 - 固定高度
            ConnectionPanel {
                vertical-stretch: 0;
                height: 100px;
                mcu-label-text: AppState.mcu-label;
                port-value <=> AppState.port-value;
                connect-status-text: AppState.connect-status;
                is-connected: AppState.is-connected;
                chip1-type: AppState.chip1-type;
                chip2-type: AppState.chip2-type;
                show-chip-info: AppState.show-chip-info;
                connect-clicked => {
                    AppState.connect-clicked();
                }
                port-changed(text) => {
                    AppState.port-changed(text);
                }
            }

            // 中：地址操作面板 - 弹性高度1
            AddressPanel {
                vertical-stretch: 1;
                min-height: 140px;
                start-address-label: AppState.start-address-label;
                param-label: AppState.param-label;
                read-address-button: AppState.read-address-button;
                write-address-button: AppState.write-address-button;
                start-address-value <=> AppState.start-address-value;
                param-value <=> AppState.param-value;
                read-address-clicked => {
                    AppState.read-address-clicked();
                }
                write-address-clicked => {
                    AppState.write-address-clicked();
                }
            }

            // 下：IO控制面板 - 弹性高度1
            IOControlPanel {
                vertical-stretch: 1;
                min-height: 140px;
                io1-low-text: AppState.io1-low;
                io1-high-text: AppState.io1-high;
                io1-display-text: AppState.io1-display;
                io1-status: AppState.io1-status;
                io2-low-text: AppState.io2-low;
                io2-high-text: AppState.io2-high;
                io2-display-text: AppState.io2-display;
                io2-status: AppState.io2-status;
                io1-low-clicked => {
                    AppState.io1-low-clicked();
                }
                io1-high-clicked => {
                    AppState.io1-high-clicked();
                }
                io2-low-clicked => {
                    AppState.io2-low-clicked();
                }
                io2-high-clicked => {
                    AppState.io2-high-clicked();
                }
            }
        }

        // 右侧面板 - 占比60%
        FileOperationPanel {
            horizontal-stretch: 0.75;
            file-status-text <=> AppState.file-status;
            file-status-color <=> AppState.file-status-color;
            read-file-button-text: AppState.read-file-button;
            read-device-button-text: AppState.read-device-button;
            config-file-button-text: AppState.config-file-button;
            file-content-label: AppState.file-content-label;
            file-content <=> AppState.file-content;
            read-file-clicked => {
                AppState.read-file-clicked();
            }
            read-device-clicked => {
                AppState.read-device-clicked();
            }
            config-file-clicked => {
                AppState.config-file-clicked();
            }
        }
    }
}
