import { Button, LineEdit, VerticalBox, HorizontalBox } from "std-widgets.slint";

export component ConnectionPanel inherits Rectangle {
    in-out property <string> mcu-label-text: "连接";
    in-out property <string> port-value: "COM5";
    in-out property <string> connect-status-text: "已连接";
    in-out property <bool> is-connected: true;
    in-out property <string> chip1-type: "";
    in-out property <string> chip2-type: "";
    in-out property <bool> show-chip-info: true;
    callback connect-clicked();
    callback port-changed(string);
    border-radius: 12px;
    border-width: 2px;
    border-color: #d0d0d0;
    background: #f8f9fa;
    drop-shadow-blur: 4px;
    drop-shadow-color: #00000020;
    VerticalBox {
        padding: 8px;
        spacing: 4px;
        HorizontalBox {
            spacing: 8px;
            Button {
                text: mcu-label-text;
                min-width: 40px;
                clicked => {
                    connect-clicked();
                }
            }

            LineEdit {
                text <=> port-value;
                placeholder-text: "端口号";
                min-width: 60px;
                edited => {
                    port-changed(self.text);
                }
            }

            Rectangle {
                min-width: 60px;
                border-radius: 6px;
                border-width: 1px;
                border-color: is-connected ? #28a745 : #dc3545;
                background: is-connected ? #d4edda : #f8d7da;
                Text {
                    text: connect-status-text;
                    color: is-connected ? #155724 : #721c24;
                    font-size: 12px;
                    font-weight: 600;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }
            }
        }

        Rectangle {
            height: 40%;
            

        // 芯片信息显示区域 - 仅在连接成功且有芯片信息时显示
        if show-chip-info: HorizontalBox {
                spacing: 8px;
                alignment: center;
                Rectangle {
                    width: 20%;  // 使用百分比宽度替代固定最小宽度
                border-radius: 4px;
                    border-width: 1px;
                    border-color: #007bff;
                    background: #e3f2fd;
                    Text {
                        text: "芯片1: " + chip1-type;
                        color: #1565c0;
                        font-size: 11px;
                        font-weight: 500;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                        overflow: elide;  // 文本过长时使用省略号
                }
                }

                Rectangle {
                    width: 20%;  // 使用百分比宽度替代固定最小宽度
                border-radius: 4px;
                    border-width: 1px;
                    border-color: #007bff;
                    background: #e3f2fd;
                    Text {
                        text: "芯片2: " + chip2-type;
                        color: #1565c0;
                        font-size: 11px;
                        font-weight: 500;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                        overflow: elide;  // 文本过长时使用省略号
                }
                }
            }
        }
    }
}
